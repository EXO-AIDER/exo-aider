function [x, x_actual, y] = test_compiled_bluetooth(num_repeats, payload)
%TEST_COMPILED_BLUETOOTH Summary of this function goes here
%   Detailed explanation goes here

    b = myBluetooth('Exo-Aider ESP32');

    %%
    count_to = 10000;

    disp(['Start - ', num2str(i)]);
    b.flush();
    
    t_start = posixtime(datetime);
    b.send('send');

    while b.get_number_of_messages < count_to
       pause(0.01); 
    end
    toc;
    elapsed_time = toc;

    x = b.message_timestamps - t_start;
    x_actual = b.message_timestamps_actual - t_start;
    y = cellfun(@(x) str2double(char(x)), b.messages);
    
    f = 
    
    disp(['Frequency: ', num2str(
    
    figure(1);
    x = b.message_timestamps - t_start;
    x_actual = b.message_timestamps_actual - t_start;
    y = cellfun(@(x) str2double(char(x)), b.messages);
    f = length(x) / elapsed_time;
    plot(x, y, x_actual, y);
    title(['Frequency: ', num2str(f)]);
    drawnow;
    pause(1);
end

